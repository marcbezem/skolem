%\documentclass[10pt,a4paper]{amsart}
\documentclass[10pt,a4paper]{article}
\ifx\pdfpageheight\undefined\PassOptionsToPackage{dvips}{graphicx}\else%
\PassOptionsToPackage{pdftex}{graphicx}
\PassOptionsToPackage{pdftex}{color}
\fi

\usepackage{diagrams1}
\usepackage[all]{xy}
\usepackage{url}
\usepackage{verbatim}
\usepackage{latexsym}
\usepackage{amssymb,amstext,amsmath}
\usepackage{authblk}
\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}


%%%%%%%%%
\def\oge{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\langle\!\langle\,$}}
\def\feg{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\,\rangle\!\rangle$}}

%%%%%%%%%

\renewcommand*{\phi}{\varphi}
\newcommand\myfrac[2]{
 \begin{array}{c}
 #1 \\
 \hline \hline 
 #2
\end{array}}

\newcommand*{\Scale}[2][4]{\scalebox{#1}{$#2$}}%
\newcommand*{\Resize}[2]{\resizebox{#1}{!}{$#2$}}

\newcommand{\ideal}[1]{\langle #1\rangle}
\newcommand{\elim}{{\sf elim}}
\newcommand{\dM}{{\sf dM}}
\newcommand{\Cir}{\mathsf{S^1}}
\newcommand{\base}{{\sf base}}
\newcommand{\inc}{{\sf inc}}
\newcommand{\inh}{\mathsf{inh}}
\newcommand{\squash}{{\sf squash}}
\newcommand{\transp}{{\sf transp}}
\newcommand{\squeeze}{{\sf squeeze}}
\newcommand{\LOOP}{{\sf loop}}
\newcommand{\Top}{{\sf Top}}
\newcommand{\Sys}{{\sf S}}
\newcommand{\Ref}{{\sf Ref}}
\newcommand{\LINE}{{\sf line}}
\newcommand{\JJ}{{\sf J}}
\newcommand{\II}{\mathbb{I}}
\newcommand{\PP}{{\sf Path}}
\newcommand{\Sp}{{\sf S}}
\newcommand{\TT}{\mathbb{F}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\DD}{\mathbb{D}}
\newcommand{\Iso}{{\sf Iso}}
\newcommand{\refl}{{\bf refl}}
\newcommand{\HH}{{\sf H}}


\newcommand{\mkbox}[1]{\ensuremath{#1}}


\newcommand{\Id}{{\sf Id}}
\newcommand{\ident}{{\sf id}}
\newcommand{\Path}{{\sf Path}}
\newcommand{\IdP}{{\sf IdP}}
\newcommand{\ID}{{\sf ID}}
\newcommand{\Equiv}{{\sf Equiv}}
\newcommand{\isEquiv}{{\sf isEquiv}}
\newcommand{\ext}{\mathsf{ext}}
\newcommand{\lift}{\mathsf{lift}}
\newcommand{\cof}{\mathsf{cof}}
\newcommand{\isContr}{{\sf isContr}}
\newcommand{\Fib}{{\sf Fib}}

\newcommand{\CC}{{\mathcal C}}
\newcommand{\subst}{{\sf subst}}
\newcommand{\res}{{\sf res}}
\newcommand{\Int}{{\bf I}}
\newcommand{\sem}[1]{\langle #1\rangle}
\newcommand{\ld}[1]{#1{\downarrow}}
\newcommand{\ldf}[1]{#1\rho_{{\downarrow}f}}

\newcommand{\Sph}{{\sf S}^1}
\newcommand{\PROP}{{\sf prop}}
\newcommand{\SET}{{\sf set}}
\newcommand{\pair}[1]{{\langle #1 \rangle}}
\newcommand{\openb}[1]{\mathsf{b}(#1)}
%\newcommand{\pth}[1]{\mathsf{P}(#1)}
\newcommand{\pth}[1]{#1^{\II}}
%\newcommand{\cyl}[1]{\mathsf{Cyl}(#1)}
\newcommand{\cyl}[1]{#1\times\II}
\newcommand{\free}[1]{\mathsf{D}(#1)}
\newcommand{\Prod}[2]{\displaystyle\prod _{#1}~#2}
\newcommand{\Sum}[2]{\displaystyle\sum _{#1}~#2}
\newcommand{\gothic}{\mathfrak}
\newcommand{\omicron}{*}
\newcommand{\gP}{{\gothic p}}
%\newcommand{\lift}[1]{\tilde{#1}}
\newcommand{\gM}{{\gothic M}}
\newcommand{\gN}{{\gothic N}}
\newcommand{\rats}{\mathbb{Q}}
\newcommand{\ints}{\mathbb{Z}}

\usepackage{epsf}
\usepackage{epsfig}
% \usepackage{isolatin1}
\usepackage{a4wide}
\usepackage{verbatim}
\usepackage{proof}
\usepackage{latexsym}
\usepackage{amssymb}
% \usepackage{stmaryrd}
\newcommand{\abs}[2]{\lambda #1 . #2}            % abstraction of #1 in #2
\usepackage{mytheorems}
%\newtheorem{proposition}[theorem]{Proposition}

%\documentstyle{article}
\newcommand{\IF}[3]{{{\sf if}~#1~{\sf then}~#2~{\sf else}~#3}}
\newcommand{\lfpi}[3]{(\Pi #1{:}#2)#3}
\newcommand{\HA}{{\sf HA}}
\newcommand{\AC}{{\sf AC}}
\newcommand{\HAw}{\hbox{\sf{HA}$^{\omega}$}}
\newcommand{\EM}{\hbox{\sf{EM}}}
\newcommand{\DC}{\hbox{\sf{DC}}}
\newcommand{\BB}{\hbox{\sf{B}}}

\def\NN{\hbox{\sf N}}
\def\Type{\hbox{\sf Type}}
%\def\Box[1]{\mathsf{b}(#1)}
\def\PER{\hbox{\sf PER}}
\def\FUN{\Pi}
\def\ELEM{\hbox{\sf El}}
\def\GG{\hbox{\sf G}}
\def\TP{\hbox{\sf TP}}
\def\N0{\hbox{\sf N}_0}
\def\ZERO{\hbox{\sf zero}}
\def\SUCC{\hbox{s}}
\setlength{\oddsidemargin}{0in} % so, left margin is 1in
\setlength{\textwidth}{6.27in} % so, right margin is 1in
\setlength{\topmargin}{0in} % so, top margin is 1in
\setlength{\headheight}{0in}
\setlength{\headsep}{0in}
\setlength{\textheight}{9.19in} % so, foot margin is 1.5in
\setlength{\footskip}{.8in}

% Definition of \placetitle
% Want to do an alternative which takes arguments
% for the names, authors etc.

\newcommand{\lbr}{\lbrack\!\lbrack}
\newcommand{\rbr}{\rbrack\!\rbrack}
%\newcommand{\sem}[2] {\lbr #1 \rbP_{#2}}  % interpretation of the terms
\newcommand{\PAIR}[2] {{<}#1,#2{>}}  % interpretation of the terms
\newcommand{\add}{\mathsf{add}}
\newcommand{\app}{\mathsf{app}}
\newcommand{\APP}{\mathsf{APP}}
\newcommand{\BAPP}[2]{\mathsf{app}(#1,#2)}
\newcommand{\nat}{{N}}
\newcommand{\NNO}{\hbox{\sf N$_0$}}
\newcommand{\UU}{\hbox{\sf U}}
\newcommand{\VV}{\hbox{\sf V}}
\newcommand{\EXIT}{\mathsf{exit}}
\newcommand{\natrec}{\hbox{\sf{natrec}}}
\newcommand{\boolrec}{\hbox{\sf{boolrec}}}
\newcommand{\nil}{[]}
\newcommand{\cons}{\mathsf{cons}}
\newcommand{\lists}{\mathsf{list}}
\newcommand{\VEC}{\mathsf{vec}}
\newcommand{\reclist}{\mathsf{RecL}}
\newcommand{\vect}{\mathsf{vect}}
\newcommand{\brecp}{\Psi}
\newcommand{\true}{\mathsf{true}}
\newcommand{\false}{\mathsf{false}}
\newcommand{\bool}{{N_2}}
\newcommand{\ifte}[3]{\mathsf{if}\ #1\ \mathsf{then}\ #2\ \mathsf{else}\ #3}
\newcommand{\nats}{\mathbb{N}}
\newcommand{\Con}{{\sf Con}}
\newcommand{\Typ}{{\sf Type}}
\newcommand{\Elem}{{\sf Elem}}
\newcommand{\Char}{{\sf Char}}
%\newcommand{\id}{{\sf id}}
\newcommand{\id}{{1}}
\newcommand{\pp}{{\sf p}}
\newcommand{\mm}{{\sf m}}
\newcommand{\qq}{{\sf q}}
\newcommand{\COMP}[3]{{\sf comp}~#1~#2~#3}
\newcommand{\comp}{{\sf comp}}
\newcommand{\hcomp}{{\sf hcomp}}
\newcommand{\genComp}{{\sf Comp}}
\newcommand{\pres}{{\sf pres}}
\newcommand{\extend}{{\sf extend}}
\newcommand{\eq}{{\sf equiv}}

\newcommand{\Transp}{{\sf fill}}
\newcommand{\Glue}{{\sf Glue}}
\newcommand{\glue}{{\sf glue}}
\newcommand{\Comp}{{\sf fill}}
% Marc's macros
\newcommand{\op}[1]{#1^\mathit{op}}
\newcommand{\set}[1]{\{#1\}} 
\newcommand{\es}{\emptyset}
\newcommand{\lto}{\longmapsto}
\newcommand{\rup}[1]{#1{\uparrow}}
\newcommand{\rdo}[1]{#1{\downarrow}}
\newcommand{\rupx}[1]{#1{\uparrow_{x}}}
\newcommand{\rdox}[1]{#1{\downarrow_{x}}}
\newcommand{\rupxy}[1]{#1{\uparrow_{x,y}}}
\newcommand{\rdoxy}[1]{#1{\downarrow_{x,y}}}
\newcommand{\rupyx}[1]{#1{\uparrow_{y,x}}}
\newcommand{\rdoyx}[1]{#1{\downarrow_{y,x}}}
\newcommand{\del}[1]{}
\newcommand{\ul}[1]{\underline{#1}}
\newcommand{\bind}[2]{{\langle}#1{\rangle}#2}
\newcommand{\lam}[2]{{\langle}#1{\rangle}#2}
\newcommand{\make}[1]{{\langle}#1{\rangle}}
\newcommand{\OO}{O}
\newcommand{\many}[2]{{#1_1},\ldots,{#1_#2}}

% end Marc's macros

\begin{document}

\title{Skolem's Theorem in Coherent Logic}

\author[1]{Marc Bezem}
\affil[1]{Department of Informatics, University of Bergen, \texttt{bezem@ii.uib.no}} 

\author[2]{Thierry Coquand}
\affil[2]{Department of Computer Science and Engineering, Chalmers/University of Gothenburg, 
\texttt{coquand@chalmers.se}}

\date{}
\maketitle

\begin{abstract}
We give a constructive proof of Skolem's Theorem for coherent logic
and discuss several applications, including a negative answer to 
a question by Wraith.
\end{abstract}

%\rightfooter{}

\section*{Introduction}
Skolemization is the replacement of an axiom of the form
\begin{equation}\label{allexist}
\forall\vec{x}~\exists y~\phi(\vec{x},y)
\end{equation}
by one of the form
\begin{equation}\label{allskol}
\forall\vec{x}~\phi(\vec{x},f_\phi(\vec{x})),
\end{equation}
where $f_\phi$ is a fresh function symbol, also called a Skolem function.
For simplicity we shall prove Skolem's Theorem for atomic $\phi$;
non-atomic instances can easily be obtained by definitional extension.
We also take the arity of $\phi$ to be at most $2$. This means
that $\vec{x}$ has length at most one and that the Skolem function is
unary or nullary, in which case we speak of a Skolem constant.
Also this simplification is harmless, as the proofs can easily be
generalized to larger arities.

Clearly, (\ref{allskol}) is stronger than (\ref{allexist}).
Nevertheless, Skolem's Theorem states that skolemization is \emph{conservative}
for classical first-order logic. This means that classical consequences of
(\ref{allskol}) not containing $f_\phi$ already follow from (\ref{allexist}).

Semantically, Skolem's Theorem follows from the observation that
any model of (\ref{allexist}) can be extended with an interpretation
of $f_\phi$ to satisfy (\ref{allskol}). This simple, elegant argument has two
drawbacks. First, the interpretation of $f_\phi$ uses the Axiom of Choice.
Second, the argument does not explain how to transform proofs using
(\ref{allskol}) into proofs using (\ref{allexist}).
Of course, the mere existence of such a proof transformation
follows from the semantical argument by applying soundness and completeness.

From the proof theoretic point of view one would like to understand
in a combinatorial way how to transform proofs using (\ref{allskol}) into proofs
using  (\ref{allexist}).  Here and below we restrict attention to
proofs with conclusion not containing $f_\phi$. After all, such proofs are finite
combinatorial objects and will not use the Skolem function in its entirety.
A proof transformation as asked for above
exists and has been defined by Maehara~\cite{Maehara}. 
In view of the simplicity of the semantical argument, the proof transformation
contains two surprises.
First, the transformed proofs can be much longer than the original, 
see \cite{BaazLeitsch94}.
Second, as we shall see below, in certain cases the transformed proofs must use
the law of the excluded middle even if the original proof does not.

One natural question is whether Skolem's Theorem holds for other logics as well.
We first consider constructive logic. Surprisingly, Skolem's Theorem fails
for constructive logic with equality, a result which is due to Mints~\cite{Mints}.
Consider the sentence
\begin{equation}\label{all2exist2}
\forall x_1,x_2~\exists y_1,y_2. ~P(x_1,y_1) \land P(x_2,y_2) \land (x_1 = x_2 \to y_1 = y_2)
\end{equation}
Clearly,  (\ref{all2exist2}) follows from (\ref{allskol}) 
with $P$ for $\phi$, by taking $y_i = f(x_i)$.
In an attempt to prove (\ref{all2exist2}) from (\ref{allexist}) 
with $P$ for $\phi$, let $x_1,x_2$ be given.
Using (\ref{allexist}) we can get $y_1,y_2$ satisfying the first two conjuncts
in (\ref{all2exist2}). However, (\ref{allexist}) does not guarantee the third conjunct.
For this we would have to decide $ x_1 = x_2 \lor x_1 \neq x_2$ before the
application of (\ref{allexist}). In constructive logic, equality is in general not decidable.
We shall prove below that indeed (\ref{all2exist2}) does not follow from  (\ref{allexist})
in constructive logic, using an argument different from \cite{Mints}.

Dowek and Werner \cite{DW} give a constructive proof of 
Skolem's Theorem for constructive logic without equality.
By viewing equality as a non-logical predicate satisfying the equality
axioms, \cite{DW} yields Skolem's Theorem for constructive logic with equality
in cases in which for all $x$ there exists a \emph{unique} $y$  such that $P(x,y)$.
Then functionality of the Skolem function follows from the uniqueness requirement.

Coherent logic is a fragment of first-order logic as described in the next section.
Its proof theory is constructive, with the property that classical logic is conservative
for this fragment. For this reason one expects Skolem's Theorem to hold
for coherent logic. Moreover, one would expect a simpler proof transformation,
with all transformed proofs constructive. We shall see that this works out
as expected.

The paper is organized as follows. In the next section we introduce coherent logic.
The easy case of Skolem constants is dealt with in Section~\ref{sec:skolemconstant},
after which we assume that Skolem functions have positive arity. In the next
section we give some lemmas used in the sequel, and we prove the
conservativity of extending the signature (which is not direct in the case
of a logic in which the domain of discourse can be empty). 
In Section~\ref{sec:addequality}/\ref{sec:skolemfunction} 
we prove Skolem's Theorem for coherent logic with/out equality.
We finish by some applications and remarks about a question of Gavin Wraith. 

\section{Coherent theories}\label{coherent}
 
We use letters $x,y,z,u,\dots$ for variables,
$r,s,t,\dots$ for terms, and $P,Q,R,\ldots$ for predicates.

\medskip

Given a signature $\Sigma$ we consider a theory $T$ with axioms of the form
$$
\Delta_0(\vec{y})~\vdash_{\vec{y}}~
\exists \vec{z_1}\Delta_1(\vec{y},\vec{z_1})\vee\dots\vee\exists \vec{z_n}\Delta_n(\vec{y},\vec{z_n})
$$
where $\Delta_0(\vec{y}),\Delta_i(\vec{y},\vec{z}), \dots$
denote conjunctions of atomic formulae
with all free variables among those explicitly shown. We may leave out the variables
when they are clear from the context.
We think of the conjunctions above as finite sets of atomic formulae.
Such sets, as well as the sequences of variables, can be empty, 
and we can have axioms with $n=0$. 

We define inductively when we have $\Gamma\vdash_{\vec{x}}^T A$ 
where $A$ is a atomic formula and $\Gamma$ a set of atomic formulae,
and all free variables of $\Gamma,A$ are in $\vec{x}$. There are two clauses:

\begin{enumerate}
\item (base) $A$ is in $\Gamma$ 

\item (step) there is an axiom 
$$
\Delta_0(\vec{y})~\vdash_{\vec{y}}~
\exists \vec{z_1}\Delta_1(\vec{y},\vec{z_1})\vee\dots\vee\exists \vec{z_n}\Delta_n(\vec{y},\vec{z_n})
$$
in $T$ and a sequence of terms $\vec{t}$ with variables in $\vec{x}$,
such that $\Delta_0(\vec{t})$ is a subset of $\Gamma$ and
we have 
$$
\Gamma,\Delta_i(\vec{t},\vec{z_i})\vdash^T_{\vec{x},\vec{z_i}} A
\quad \text{for all $i = 1,\dots,n$.}
$$
Here and below we write $\Gamma,\Delta$ for the union of $\Gamma$ and $\Delta$.
\end{enumerate}

In the special case $n=0$ the above inductive definition
means that $\Gamma\vdash_{\vec{x}} A$ for any $A$ if $\Gamma$
includes a finite set $\Delta_0(\vec{t})$. This shows that $\bot$ (absurdity) in coherent logic
is represented by the empty disjunction, satisfying the Ex Falso rule. Dually, we have $\top$
in coherent logic represented by  the empty conjunction (set of atoms), 
which is true in any $\Gamma$.

\section{Skolem constants}\label{sec:skolemconstant}

Coherent is a logic that, unlike ordinary first-order logic with Tarski semantics,
allows the domain to be empty. This means that adding a constant to a signature
that does not contain constant symbols is \emph{not} conservative.
As an example, consider the axiom $\vdash_{y} P$ for a proposition $P$.
Despite the left-hand side being empty,
we can only infer $\vdash P$ if we have a constant in the signature.

Skolemization with constants is conservative, and the proof is simpler than,
but slightly different from, the case of Skolem functions.
Therefore we deal with Skolem constants in this section first.
This will also give us a good picture of what we need to prove
the case of Skolem functions.

%TODO Without loss of generality we take $\phi$ to be $P$
Let $T$ be a coherent theory with $\vdash\exists y P(y)$ among its axioms.
Replace this axiom by $\vdash P(c)$ for a fresh constant $c$
and call the resulting theory $T_c$. 

\begin{theorem}
If $\Gamma,A$ does not mention $c$ and $\Gamma\vdash_{\vec{x}}^{T_c} A$, then
$\Gamma\vdash_{\vec{x}}^{T} A$.
\end{theorem}

\begin{proof}
If $\Gamma\vdash_{\vec{x}}^{T_c} A$, then $\Gamma,P(c)\vdash_{\vec{x}}^{T_c} A$
by weakening, to be proved in Lemma~\ref{weak}.
From the resulting proof we remove all now pre-empted applications of
the axiom $\vdash P(c)$. We then
replace every occurrence of $c$ by a fresh variable $u$ and 
get a proof of $\Gamma,P(u)\vdash_{\vec{x},u}^{T} A$.
This substitution operation will be defined in Section~\ref{auxlemmas}
and leaves $\Gamma,A$ unchanged.
It also replaces $c$ by $u$ in instantiations of axioms of $T_c$,
which is important to get a proof in $T$. Finally,
by applying the axiom $\vdash\exists y P(y)$ in $T$ 
we get a proof of $\Gamma\vdash_{\vec{x}}^{T} A$.
\end{proof}

Skolem constants are special since the axiom $\vdash\exists y P(y)$
makes the domain non-empty, which is not true for $\vdash_x\exists y P(x,y)$.
From now on we assume that the Skolem function has positive arity.

\section{Some Lemmas}\label{auxlemmas}

%% \begin{lemma}\label{rename}
%% If $\sigma$ is a renaming on variables and
%% $\Gamma\vdash_{\vec{x}}^T A$ then $\Gamma\sigma\vdash_{\vec{x},z}^T A\sigma$.
%% \end{lemma}
The first two lemmas are for weakening and instantiation, and we omit their obvious proofs.

\begin{lemma}\label{weak}
If $\Gamma\vdash_{\vec{x}}^T A$, $\vec{x}\subseteq \vec{y}$, $\Gamma\subseteq \Sigma$ and all free variables of $\Sigma$ are in $\vec{y}$, then $\Sigma\vdash_{\vec{y}}^T A$.
\end{lemma}

\begin{lemma}\label{subst1}
If $|\vec{t}| =|\vec{x}|$ and the free variables of $\vec{t}$ are in $\vec{y}$, 
then $\Gamma(\vec{t})\vdash_{\vec{y}}^T A(\vec{t})$ whenever
$\Gamma(\vec{x})\vdash_{\vec{x}}^T A(\vec{x})$.
\end{lemma}

We will continue using ordinary substitution of variables \emph{by} terms implicitly, 
such as in, for example, $\Gamma(\vec{t})$. 
In proving Skolem's Theorem we also need to
substitute terms \emph{by} variables. This we denote explicitly.
For a term $r$ and a variable $u$ we denote by $\rho = \rho_{r,u}$ the 
substitution of $r$ by $u$, defined inductively on terms by:
\begin{itemize}
\item $s\rho = u$ if $s = r$, and otherwise
\item $f(\vec{t})\rho = f(\vec{t}\rho)$,
\item $x\rho = x$.
\end{itemize}
We extend in the usual way by taking $P(\vec{t})\rho = P(\vec{t}\rho)$ for
predicate symbols  $P$, and likewise for sets of atoms. 
One subtlety in the interaction of the two notions of subtitution is that for an
atomic formula $A(\vec{x})$ in free variables $\vec{x}$ and
a sequence of terms $\vec{t}$, $A(\vec{t})\rho$
can be different from $A(\vec{t}\rho)$ when $A(\vec{x})$
contains the term $r$. For example, if  $A(x) = P(r,x)$
and $t=r$ a constant, then $A(t)\rho = P(u,u)$ and $A(t\rho) = P(r,u)$.
Even worse, if $A(x) = P(f(x))$ and $t=c$ and $r=f(c)$,
then $A(t)\rho = P(u)$ and $A(t\rho) = P(f(c))$.
A sufficient condition to rule out these anomalies is given in
the following lemma, whose simple proof we omit.

\begin{lemma}\label{subst0}
If $\rho = \rho_{r,u}$ and the head symbol of $r$ does not occur in 
$\phi(\vec{x})$, then $\phi(\vec{t})\rho =\phi(\vec{t}\rho)$.
\end{lemma}

\begin{lemma}\label{subst2}
Assume $\rho = \rho_{r,u}$ and the head symbol of $r$ does not occur in $T$.
If all free variables of $r$ are in $\vec{x}$, then $\Gamma\rho\vdash_{\vec{x},u}^T A\rho$
whenever $\Gamma\vdash_{\vec{x}}^T A$.
\end{lemma}

\begin{proof}
By induction on the proof of $\Gamma\vdash_{\vec{x}}^T A$.
If $A$ is in $\Gamma$ then $A\rho$ is in $\Gamma\rho$.
If there is a rule
$$
\Delta_0(\vec{y})~\vdash_{\vec{y}}~
\exists \vec{z_1}\Delta_1(\vec{y},\vec{z_1})\vee\dots\vee\exists \vec{z_n}\Delta_n(\vec{y},\vec{z_n})
$$
in $T$ such that $\Delta_0(\vec{t})$ is a subset of $\Gamma$ and
we have $\Gamma,\Delta_i(\vec{t},\vec{z_i})\vdash^T_{\vec{x},\vec{z_i}} A$ for all $i = 1,\dots,n$,
where $\vec{t}$ are terms using variables in $\vec{x}$, then we have by induction
$\Gamma\rho,\Delta_i(\vec{t},\vec{z_i})\rho\vdash^T_{\vec{x},\vec{z_i},u} A\rho$
for all $i = 1,\dots,n$. 

We want to apply the same rule as above, instantiated
with $\vec{t}\rho$ instead of $\vec{t}$. From Lemma~\ref{subst0} we get that
$\Delta_0(\vec{t}\rho) = \Delta_0(\vec{t})\rho$ is a subset of $\Gamma\rho$.
Also, $\Delta_i(\vec{t},\vec{z_i})\rho = \Delta_i(\vec{t}\rho,\vec{z_i})$ 
for all $i = 1,\dots,n$, since $z\rho = z$ for any variable $z$ in $\vec{z_i}$.
Hence we get
$\Gamma\rho,\Delta_i(\vec{t}\rho,\vec{z_i})\vdash^T_{\vec{x},\vec{z_i},u} A\rho$ for all $i = 1,\dots,n$,
and we can infer $\Gamma\rho\vdash^T_{\vec{x},u} A\rho$ as desired.
\end{proof}

The combination of Lemma~\ref{subst1} and \ref{subst2} makes
substitution of terms for terms possible.

\begin{lemma}\label{cut}
If $\Gamma\vdash_{\vec{x}}^T A$ and $\Delta,A\vdash_{\vec{x}}^T B$ then
$\Gamma,\Delta\vdash_{\vec{x}}^T B$
\end{lemma}

\begin{proof}
By induction on the proof of $\Gamma\vdash_{\vec{x}}^T A$. If $A$ belongs to $\Gamma$ we can
conclude by Lemma \ref{weak}. 
Otherwise we have a rule
$$
\Delta_0(\vec{y})~\vdash_{\vec{y}}~
\exists \vec{z_1}\Delta_1(\vec{y},\vec{z_1})\vee\dots\vee\exists \vec{z_n}\Delta_n(\vec{y},\vec{z_n})
$$
in $T$ such that $\Delta_0(\vec{t})$ is a subset of $\Gamma$ and
$\Gamma,\Delta_i(\vec{t},\vec{y_i})\vdash_{\vec{x},\vec{y_i}} A$ for all $i$.
By induction, we have $\Gamma,\Delta,\Delta_i(\vec{t},\vec{y_i})\vdash_{\vec{x},\vec{y_i}} B$ for all $i$
and hence $\Gamma,\Delta\vdash_{\vec{x}}^T B$ as desired.
\end{proof}

We will use yet another kind of substitution. Define by induction on terms an operation
$\ldf{}$ that replaces \emph{recursively} any $f$-term by its leftmost subterm:
\begin{itemize}
\item $\ldf{f(\vec{t})} = \ldf{t_1}$, and otherwise
\item $\ldf{g(\vec{t})} = g(\ldf{\vec{t}})$,
\item $\ldf{x} = x$.
\end{itemize}
Again we extend in the usual way for atoms and sets of atoms.
One relevant (but trivial) observation is that $\ldf{t}$ contains no occurrences of $f$
and that all variables in $\ldf{t}$ occur in $t$.

The following lemma implies the conservativity of adding a new
function symbol to the signature.

\begin{lemma}\label{subst3}
Let $T$ be a theory with equality.
Let $T_{f{=}}$ be $T$ extended by the congruence axiom 
$\vec{x}=\vec{y} \vdash_{\vec{x},\vec{y}} f(\vec{x}) = f(\vec{y})$
for a new function symbol $f$. 
Then we have $\ldf{\Gamma}\vdash_{\vec{x}}^T \ldf{A}$
whenever $\Gamma\vdash_{\vec{x}}^{T_{f{=}}} A$.
If the latter derivation does not mention $=$, then neither does the former.
%by a derivation of the same size.
\end{lemma}

\begin{proof}
By induction on derivation. No axiom of $T$ mentions $f$, which means
that applications of axioms of $T$ commute with $\ldf{}$. The only case of
interest is the application of the  congruence axiom for $f$:
$\vec{s}=\vec{t} \vdash_{\vec{x}} f(\vec{s}) = f(\vec{t})$. Applying $\ldf{}$ we get 
$\vec{s}\ldf{}=\vec{t}\ldf{} \vdash_{\vec{x}} s_1\ldf{} = t_1\ldf{}$,
and see that the conclusion is among the premisses. This means the congruence
axiom for $f$ can be left out, and all occurrences of $f$ have disappeared.
\end{proof}



\section{Elimination of function symbols}\label{sec:skolemfunction}

In this section we prove Skolem's Theorem for coherent logic without equality.
This case is essentially simpler since, without congruence for $f$, 
only axiom (\ref{allskol}) mentions the Skolem function $f$. 

We assume that we have the rule $\vdash_{x}\exists y~P(x,y)$ in $T$.
Let $f$ be a unary function symbol that is \emph{not} in the language of $T$ and 
let $T_f$ be the theory $T$ in the signature extended with $f$.
Let $T_{f+}$ be the extension of $T_f$ with the rule
$$
\vdash_{y}~P(y,f(y))\leqno{(*)}
$$

Our aim is to prove that $T_{f{+}}$ is a conservative extension of $T$.
The main idea is that if we use $f$ and the axiom $(*)$ with $P(t,f(t))$,
then we should be able to replace $f(t)$ by a fresh variable 
and get $P(t,u)$, and then use the axiom $\exists u~P(t,u)$ in $T$.
This idea is cleverly expressed in the crucial Lemma~\ref{crucial} 
(which comes from \cite{Maehara}). We prepare by a simpler lemma.

\begin{lemma}\label{simpl}
If $\Gamma,P(t,f(t))\vdash_{\vec{x}}^{T_f} A$ and
$f(t)$ is not in $\Gamma,A$, then $\Gamma\vdash_{\vec{x}}^{T_f} A$.
\end{lemma}

\begin{proof}
We take $r = f(t)$ and we use Lemma \ref{subst2}. We get
$\Gamma,P(t,u)\vdash_{\vec{x},u}^{T_f} A$. Since we also have
$\vdash_{\vec{x}}\exists u~P(t,u)$ we get  $\Gamma\vdash_{\vec{x}}^{T_f} A$.
\end{proof}

\begin{corollary}\label{simpl1}
If $\Gamma,P(t_1,f(t_1)),\dots,P(t_n,f(t_n))\vdash_{\vec{x}}^{T_f} A$ and
$f(t_i)$ is not in $\Gamma,A,t_j$ for $1\leq j < i \leq n$,
then $\Gamma\vdash_{\vec{x}}^{T_f} A$.
\end{corollary}


\begin{lemma} \label{crucial} (crucial) 
If $\Gamma\vdash_{\vec{x}}^{T_{f{+}}} A$ then $\Gamma,\Sigma\vdash_{\vec{x}}^{T_f} A$ for
some set $\Sigma$ of formulae $P(t,f(t))$ with $f(t)$ occurring in $\Gamma,A$.
\end{lemma}

\begin{proof}
By induction on the proof of $\Gamma\vdash_{\vec{x}}^{T_{f{+}}} A$.
The base case is if $A$ is in $\Gamma$. Then we have
$\Gamma,\Sigma\vdash_{\vec{x}}^{T_f} A$ for empty $\Sigma$.
In the step case we distinguish between $(*)$ and other axioms
$$
\Delta_0(\vec{y})~\vdash_{\vec{y}}~
\exists \vec{z_1}\Delta_1(\vec{y},\vec{z_1})\vee\dots\vee\exists \vec{z_n}\Delta_n(\vec{y},\vec{z_n})
$$
in $T$ with $\vec{t}$ terms using free variables in $\vec{x}$ and
we have $\Delta_0(\vec{t})$ subset of $\Gamma$ and
$\Gamma,\Delta_i(\vec{t},\vec{z_i})\vdash_{\vec{x},\vec{z_i}}^{T_{f{+}}} A$ for $i=1,\dots,n$.
By the induction hypothesis we have $\Gamma,\Delta_i(\vec{t},\vec{z_i}), \Sigma_i\vdash_{\vec{x},\vec{z_i}}^{T_f} A$
for $i = 1,\dots,n$, where $\Sigma_i$ is a set of formulae $P(t,f(t))$ where
$f(t)$ occurs in $\Gamma,A,\Delta_i(\vec{t},\vec{z_i})$.
Since $\Delta(\vec{y},\vec{z_i})$ does not mention $f$ and all free variables of $\vec{t}$ are
in $\vec{x}$ it follows that all free variables of $\Sigma_i$ are in $\vec{x}$.
Hence we have $\Gamma,\Sigma_1,\dots,\Sigma_n\vdash_{\vec{x}}^{T_f} A$.
Using Corollary \ref{simpl1} with the $f$-terms in the right order, 
we get the required conclusion.

The last case is that we have used the axiom $(*)$ and
we have $\Gamma,P(t,f(t))\vdash_{\vec{x}}^{T_{f{+}}} A$. By the induction hypothesis we get
$\Gamma,P(t,f(t)),\Sigma \vdash_{\vec{x}}^{T_f} A$ and we are
done using Corollary \ref{simpl1} as in the previous case.
\end{proof}

\begin{theorem}\label{thm:skolem}
If $\Gamma,A$ does not mention $f$ and $\Gamma\vdash_{\vec{x}}^{T_{f{+}}} A$, then
$\Gamma\vdash_{\vec{x}}^T A$.
\end{theorem}

\begin{proof}
By the previous Lemma we get $\Gamma\vdash_{\vec{x}}^{T_f} A$. We then conclude
$\Gamma\vdash_{\vec{x}}^T A$ by Lemma~\ref{subst3}.
\end{proof}

\subsection{Example}

Total preorders with a ternary predicate for maximum can be axiomatized by:
\begin{align*}
                                                 &\vdash_{x,y}           x\leq y \lor y\leq x
&\quad\text{(this implies reflexivity)}\\
x\leq y, y\leq z              &\vdash_{x,y,z}        x\leq z\\
x\leq z, y\leq z                   &\vdash_{x,y,z}           M(x,y,z)
&\quad\text{(M-intro)}\\ 
%y \leq x                                    &\vdash_{x,y}           M(x,y,x)\\
M(x,y,z)                                   &\vdash_{x,y,z}        x\leq z,  y\leq z
&\quad\text{(M-elim1)}\\
M(x,y,z), x\leq u,  y\leq u      &\vdash_{x,y,z,u}    z\leq u
&\quad\text{(M-elim2)}\\
\end{align*}
Call this theory $T_0$. Note that in a preorder maxima need not be unique.

In the following we show how to work with disjunction and existential
quantification by means of admissible rules, that is, coherent
axioms that do not give new coherent consequences. Although we
only show this for the example, the method is completely general.
Consider the following stylized derivation in the theory above:
\begin{align*}
& x\leq y, y\leq y,M(x,y,y)\\
&{\hphantom w} \lor\\
&y\leq x, x\leq x,M(x,y,x) \\
\end{align*}
This derivation shows that $\vdash_{x,y} M(x,y,x)  \lor M(x,y,y)$ is an
admissible rule. Call the extension of $T_0$ by this rule $T_1$.

Let $T_2$ be $T_1$ plus the axiom $\vdash_{x,y} \exists u M(x,y,u)$.
If $\Gamma \vdash_{\vec{x}}^{T_2} A$ has been inferred from
$\Gamma,M(x,y,u) \vdash_{\vec{x},u}^{T_1} A$ with $u$ fresh,
then by Lemma~\ref{subst1} we can substitute both $x$ and $y$ 
for the lone variable $u$ and get $\Gamma,M(x,y,x) \vdash_{\vec{x}}^{T_1} A$
and $\Gamma,M(x,y,y) \vdash_{\vec{x}}^{T_1} A$, respectively.
Hence we also have $\Gamma \vdash_{\vec{x}}^{T_1} A$
by using $\vdash_{x,y} M(x,y,x)  \lor M(x,y,y)$.
This means that $\vdash_{x,y} \exists u M(x,y,u)$ is an admissible rule
for $T_1$.

Let $T_3$ be $T_2$ plus the axiom $\vdash_{x,y} M(x,y,m(x,y))$. 
Theorem~\ref{thm:skolem} states that  $T_3$ is conservative over
$T_2$ and hence also over $T_1$ and $T_0$. This means we can add
$\vdash_{x,y} M(x,y,m(x,y))$ to $T_0$ without getting more consequences
in the signature $\set{M,{\leq}}$. This is somehow surprising since maxima
need not be unique in a preorder, so that $m(x,y)$ must make a choice.
 We will see that the same result holds even in coherent logic with equality.

%%  If we have an equality symbol, we consider that we have added all equality axioms for
%% predicate and function symbols in the theory. It follows from this Theorem that we
%% can eliminate function symbols whenever we have unique existence. 

\section{Addition of equality}\label{sec:addequality}

In logic with equality, when we add a function symbol $f$, 
we must also add a congruence axiom for that function. 
This means that $T_f$ in Section~\ref{sec:skolemfunction},
when extended to  logic with equality, will in fact mention $f$ . 
This invalidates the application of Lemma~\ref{subst2}, 
which requires that the theory does not mention $f$.
The upshot is that we have to adapt the proofs of the
previous section to the case with equality.

To get a clearer picture of what is needed we translate the 
counterexample~(\ref{all2exist2}) from the introduction to coherent logic.
To this end we introduce a new predicate $I(x_1,x_2,y_1,y_2)$
expressing $x_1=x_2 \to y_1=y_2$ by coherent axioms.

\begin{definition}\label{def:implicational_equality}
A coherent theory with \emph{implicational} equality includes the axioms:
\begin{align*}
 I(x_1,x_2,y_1,y_2), x_1=x_2 & \vdash_V                 y_1=y_2  &\text{(I-elim)}\\
 y_1=y_2                                  &\vdash_V                 I(x_1,x_2,y_1,y_2)&\text{(I-intro1)}\\ 
                                                 &\vdash_V                 I(x_1,x_2,y_1,y_2) \lor x_1= x_2&\text{(I-intro2)}
 %                                                &\vdash_{z,z'}           z=z' \lor z\neq z'\\
 %z=z' \land z\neq z'                &\vdash_{z,z'}           \bot\\
\end{align*}
Here $V$ consists of  the variables $x_1,x_2,y_1,y_2$.
We include the usual axioms of equality, but
in theories with implicational equality we state the congruence axiom for 
a unary function $f$ by $\vdash_{x,x'} I(x,x',f(x),f(x'))$.
\end{definition}

Implicational equality is conservative over equality, for example,
one can substitute $x_1=x_2 \to y_1=y_2$
for $I(x_1,x_2,y_1,y_2)$ and observe that the axioms above become
\emph{classical} tautologies. Then one can apply the conservativity of 
classical logic over coherent logic. 
This special case of Barr's Theorem~\cite{Barr} has been proved
constructively by several people, using cut-elimination,
see \cite[Sec. 6]{Negri03} for an overview.

\begin{example}\label{exa:counter2CL}
Let $T$  be a theory with implicational equality with the $f$-axioms:
\begin{equation}\label{faxioms}
\vdash_{x,x'} I(x,x',f(x),f(x') )\quad\quad \vdash_{x} P(x,f(x))
\end{equation}
Using two new constants $a$ and $b$ we express (\ref{all2exist2}) coherently
(in one of the many possible ways):
\[
P(a,y_1),P(b,y_2),I(a,b,y_1,y_2)  \vdash_{y,y'} \bot
\]

Consider the following streamlined proof of $\bot$ in the theory above:
\begin{align*}
P(a,f(a)), P(b,f(b)),I(a,b,f(a),f(b)),\bot
\end{align*}
How to transform this derivation into one using 
$\vdash_{x} \exists u P(x,u)$ instead of the $f$-axioms 
in (\ref{faxioms}) above? Starting by $P(a,u), P(b,v)$
there is no way to conclude $u=v$ from $a=b$.
One solution is to use the instance $I(a,b,u,v) \lor a=b$ of (I-intro2).
Then the first branch is immediate, and in the second
we can infer $P(b,u)$ from $P(a,u)$ by equality reasoning and use 
the instance $I(a,b,u,u)$ of (I-intro1):
\begin{align*}
&I(a,b,u,v),\bot\\
P(a,u),P(b,v),&{\hphantom w}\lor\\
& a=b,P(b,u),I(a,b,u,u),\bot\\
\end{align*}
This idea is elaborated in the following lemma.
\end{example}




\begin{lemma}\label{lem:main}
Let $T_{f\!I\!{+}}$ be a coherent theory with implicational equality consisting of
axioms not mentioning $f$ plus the $f$-axioms $\vdash_{x,x'} I(x,x',f(x),f(x'))$
and $\vdash_{{y}} P({y},f({y}))$. Let $T$ be the coherent theory obtained from 
$T_{f\!I\!{+}}$ by leaving out the $f$-axioms and adding $\vdash_{{y}} \exists u P({y},u)$.
Then we have:
\begin{enumerate}
\item If $\Gamma,P(t,f(t)), I(t,u_1,f(t),f(u_1)),\ldots,I(t,u_n,f(t),f(u_n))\vdash_{\vec{x}}^{T} A$
and $f(t)$ does not occur in $\Gamma,A$, $u_1,\ldots,u_n$, then  
$\Gamma,\Sigma\vdash_{\vec{x}}^{T} A$, where $\Sigma$ consists of 
all $P(u_i,f(u_i))$ and $I(u_i,u_j,f(u_i),f(u_j))$;
\item (crucial) If $\Gamma\vdash_{\vec{x}}^{T_{f\!I\!{+}}} A$, 
then $\Gamma,\Sigma\vdash_{\vec{x}}^{T} A$,
where $\Sigma$ contains all $P(t,f(t))$ and
$I(t,u,f(t),f(u))$ such that $f(t)$ and $f(u)$ occur in $\Gamma,A$.
\end{enumerate}
\end{lemma}

\begin{proof}
1. By Lemma~\ref{subst2} we can substitute a fresh variable $y$ for $f(t)$ and get:
\begin{equation}\label{eq:ft=y}
\Gamma,P(t,y),  I(t,u_1,y,f(u_1)),\ldots,I(t,u_n,y,f(u_n))\vdash_{\vec{x},y}^{T} A
\end{equation}
Note that $t=u_i,y=f(u_i),\Gamma,\Sigma\vdash_{\vec{x},y}^{T} A$,
for any $i$, follows from (\ref{eq:ft=y}) by weakening and equality reasoning:
get $P(t,y)$ from $P(u_i,f(u_i))\in\Sigma$, and get each $I(t,u_j,y,f(u_j))$ 
from $I(u_i,u_j,f(u_i),f(u_j))\in\Sigma$. 
By substituting $f(u_i)$ for the
lone variable $y$ we get $(\ast)~t=u_i,\Gamma,\Sigma\vdash_{\vec{x}}^{T} A$
by Lemma~\ref{subst1} and reflexivity.

Now build a proof of $\Gamma,\Sigma\vdash_{\vec{x}}^{T} A$ from first 
$\Gamma,\Sigma,P(t,y)\vdash_{\vec{x},y}^{T} A$ and then repeated
application of the rule (I-intro2) with $I(t,u_i,y,f(u_i)) \lor t=u_i$. 
All right branches are closed by weakening  $(\ast)$. As a result the derivation
is left-leaning and the leftmost branch of length $n$ is closed by
weakening (\ref{eq:ft=y}).

2. By induction on the derivation of $\Gamma\vdash_{\vec{x}}^{T_{f\!I\!{+}}} A$.
There are three cases to distinguish, depending on the last step in the derivation.
In all cases we have to prove $\Gamma,\Sigma\vdash_{\vec{x}}^{T} A$.

Case $P(t,f(t))$. By induction we have 
\begin{equation}\label{ih:Ptft}
\Gamma,\Sigma,P(t,f(t)), I(t,u_1,f(t),f(u_1)),\ldots,I(t,u_n,f(t),f(u_n))\vdash_{\vec{x}}^{T} A
\end{equation}
where $\Sigma$ consists of all $P(u_i,f(u_i))$ and $I(u_i,u_j,f(u_i),f(u_j))$
with $f(u_i),f(u_j)$ in $\Gamma,A$. 
If $f(t)$ occurs in $\Gamma,A$ we are done.
Otherwise we apply Part~1 of the lemma and we are also done.

Case $I(s,t,f(s),f(t))$. By induction we have 
\begin{equation}\label{ih:Istfsft}
\Gamma,I(s,t,f(s),f(t)),\Sigma'\vdash_{\vec{x}}^{T} A
\end{equation}
where $\Sigma'$ consists of all $P(u_i,f(u_i))$ and $I(u_i,u_j,f(u_i),f(u_j))$
with $f(u_i),f(u_j)$ in $\Gamma,A,f(s),f(t)$. 
Let $\Sigma$ consists of all $P(u_i,f(u_i))$ and $I(u_i,u_j,f(u_i),f(u_j))$
with $f(u_i),f(u_j)$ in $\Gamma,A$.
Modulo idempotence, reflexivity and symmetry we get:
\begin{equation}\label{eq:sigmas}
\Sigma' = \Sigma,P(s,f(s)),P(t,f(t)),I(s,t,f(s),f(t)),\ldots,I(s,u_i,f(s),f(u_i)),\ldots,I(t,u_i,f(t),f(u_i)),\ldots
\end{equation}
If $f(s),f(t)$ both in $\Gamma,A$,
then $\Sigma'=\Sigma$ and we are done. Otherwise, there are several cases
to distinguish. If $f(s)$ in $\Gamma,A$ but not $f(t)$, then we are done by Part~1,
and likewise for $f(t)$ in $\Gamma,A$ but not $f(s)$. The case that neither
$f(s)$ nor $f(t)$ is in $\Gamma,A$ can be further split into subcases. First, if $s$ and $t$
are identical, then we are done by Part~1. If not, and if $f(t)$ is not a subterm of $s$,
then we are done by two applications of Part~1, first for $f(t)$, then for $f(s)$.
If $f(t)$ is a subterm of $s$, then $f(s)$ is not a subterm of $t$, and we are 
again done by two applications of Part~1.

Case of any axiom not mentioning $f$. Then we have an axiom
$$
\Delta_0(\vec{y})~\vdash_{\vec{y}}~
\exists \vec{z_1}\Delta_1(\vec{y},\vec{z_1})\vee\dots\vee\exists \vec{z_n}\Delta_n(\vec{y},\vec{z_n})
$$
in $T$ and terms $\vec{t}$ with free variables in $\vec{x}$ such
that $\Delta_0(\vec{t})$ is a subset of $\Gamma$ and we have
$\Gamma,\Delta_i(\vec{t},\vec{z_i})\vdash_{\vec{x},\vec{z_i}}^{T_{f\!I\!{+}}} A$ 
for $i=1,\dots,n$.
By induction we have $\Gamma,\Delta_i(\vec{t},\vec{z_i}), \Sigma_i\vdash_{\vec{x},\vec{z_i}}^{T} A$
for $i = 1,\dots,n$, where $\Sigma_i$ is the set of formulae $P(u_j,f(u_j))$ and $I(u_j,u_k,f(u_j),f(u_k))$
with $f(u_j),f(u_k)$ in in $\Gamma,A,\Delta_i(\vec{t},\vec{z_i})$.
Since $\Delta_i(\vec{y},\vec{z_i})$ does not mention $f$, all $f$-terms in
$\Sigma_i$  either occur in $\Gamma,A$, or are subterms of $\vec{t}$, so with
all free variables in $\vec{x}$. It follows that we have
$\Gamma,\Sigma_1,\dots,\Sigma_n\vdash_{\vec{x}}^{T} A$
by the same instance of the same axiom above. Now use Part~1 to eliminate
all $f$-terms not occurring in $\Gamma,A$, starting by the maximal ones.
\end{proof}

We can now state and prove Skolem's Theorem in logic with implicational equality.

\begin{theorem}\label{thm:skolemwith=}
If $\Gamma\vdash_{\vec{x}}^{T_{f\!I\!{+}}} A$ and $\Gamma,A$ does not mention $f$,
then $\Gamma\vdash_{\vec{x}}^{T} A$ by a derivation not mentioning $f$.
\end{theorem}
\begin{proof}
By Part 2 of Lemma~\ref{lem:main}. Remaining occurrences of $f$
in the derivation can be removed by Lemma~\ref{subst3}.
\end{proof}

\section{Examples}

In this section the generic model of a coherent theory will play a role.
For reasons of space it is not possible to explain this concept
in categorical semantics here. Instead we refer to \cite{MLM94}.
For the purpose of this paper, the most important property is that 
the generic model is complete with respect coherent sentences.
Furthermore, truth in the generic model can be characterized
by a forcing relation in a suitable site.

\subsection{Remarks about a question of Gavin Wraith}

Let $\vdash_i$ and $\vdash_c$ mean derivability in intuitionistic and classical logic,
respectively. Given a coherent theory $T$, a sentence $\psi$ 
(which needs not be coherent and may extend the signature of $T$)
is called $T$-\emph{redundant} by
Wraith~\cite[p. 336]{Wraith}\footnote{The difference
between geometric logic and coherent logic is not relevant for our remarks here.},
if for any coherent $\phi$ we have
$\vdash^T \phi$ whenever $T,\psi \vdash_i \phi$.
Known sources of $T$-redundancy are:
\begin{enumerate}
\item $T \vdash_i \psi$, including the case that $\psi$ is coherent.
In this case $T$-redundancy is obvious.
\item $T \vdash_c \psi$. In this case $T$-redundancy follows from the conservativity
of classical logic over coherent logic.
\item $\psi$ is true in the generic model of $T$. In this case $T$-redundancy is
has been observed by Kock~\cite{Kock1976} as a consequence of the coherent 
completeness of the generic model.
\item $\psi$ is true in some other model of $T$ that is complete for coherent 
sentences. This case can be understood in the same way as the previous one: 
if $T,\psi \vdash_i \phi$, then $T \vdash_i \psi\to\phi$, so $\psi\to\phi$ is true in
the model of $T$, and so is $\phi$, hence $\vdash^{T} \phi$ by completeness.
\end{enumerate}
These points need not exclude each other.

Wraith~\cite[p. 336]{Wraith} asks furthermore whether every $T$-redundant
sentence is true in the generic model. This is clearly true for the points 1 and 3 above.
However, it need not be true if the $T$-redundancy comes from point 2 or 4.
Perhaps the easiest negative answer to Wraith's question is the case of
the empty theory $T$ over the signature with only a propositional variable $P$.
Then $P\lor\neg P$ is $T$-redundant, but not true in the generic model of $T$
(it can easily be shown not to be forced). In \cite{BBC18} an example of
a $T$-redundant formula as under point 4 has been given, and this formula is
not true in the generic model.

We will now elaborate the example (\ref{all2exist2}) from the introduction, 
which will turn out to fall under point 2 above, but not under point 3.
Consider a language with $=$ and a binary relation $P$. Let the theory $T$ consist of
$\vdash_x \exists y~P(x,y)$. Add a function symbol $f$ plus its congruence axiom
and the axiom $\vdash _y P(y,f(y))$ to get a theory $T'$.
Applying Theorem~\ref{thm:skolemwith=} we get that $T'$ is conservative
over $T$ for coherent sentences. 
In $T'$ we can prove constructively, by taking $y_i = f(x_i)$,
the following non-coherent sentence:
$$
\exists y_1~y_2~(P(x_1,y_1)\wedge P(x_2,y_2)\wedge (x_1=x_2\rightarrow y_1=y_2))\leqno{(**)}
$$
From the conservativity of $T'$ we get that $(**)$ is $T$-redundant,
which also follows from $T\vdash_c (**)$.
However, we do \emph{not} have $T\vdash_i (**)$.
This can be proved in many different ways: 
Mints~\cite{Mints} gives a proof-theoretic argument.
There exists a simple Kripke countermodel. 
Here we show that $(**)$ is not valid in the generic model of $T$. 
As a consequence, $(**)$ is a negative answer to the question of Gavin Wraith. 

The generic model can be described as a site model.
The objects $(I;P_I)$ of the site are relations $P_I$ on a finite set  $I$ (so, graphs) .
Morphisms are maps $f:I\rightarrow J$ which preserve the relation: if $P_I(i_0,i_1)$
then $P_J(f(i_0),f(i_1))$ (graph morphisms). A basic covering is determined by the
only axiom $\vdash_x \exists y~P(x,y)$, and each object $(I;P_I)$ is covered by an
object $(I,j;P_I,P(i,j))$, for any $i$ in $I$ and fresh element $j$. (The covers
all consist of single objects since the theory contains no disjunction; 
the fresh $j$ comes from the existential quantification.)
The covariant functor $(I;P_I)\longmapsto I$ satisfies the sheaf condition and is the domain
of the generic model. 
(Note that $I$ is precisely the set of terms with variables in $I$, since the
signature contains no function symbols.)
We define the forcing relation $(I,P_I)\Vdash\phi$ by induction on $\phi$ 
as usual, in Kripke-Joyal style.
It can then be checked that the formula $(**)$ above is not forced.
%Details can be found in \cite{BBC18} (contravariant direction).


\subsection{Algebraically closed field}

We can take $T$ be the theory of algebraically closed fields. 
This is the equational theory of rings (which is coherent), together with the 
coherent axioms
$$
\vdash_x x = 0 \vee \exists y~(xy = 1)~~~~~~~~~~~~
\vdash_{x_1,\dots,x_n} \exists x~(x^n = x_1 x^{n-1} + \dots + x_n)
$$
Using only the field axioms we can show that the following rule is admissible:
$$
\vdash_{x} \exists u~ (x(1-ux) = 0)
$$
For if $\Gamma,\,t(1-ut) = 0\vdash_{\vec{x},u}^{T} A$ with $u$ fresh and
$t$ with variables in $\vec{x}$, then we can prove $\Gamma\vdash_{\vec{x}}^{T} A$.
Using the field axiom it suffices to prove  $\Gamma,t=0\vdash_{\vec{x}}^{T} A$
and $\Gamma,ty=1\vdash_{\vec{x},y}^{T} A$. Both follow from the assumption.  

By Skolem's Theorem~\ref{thm:skolemwith=} we can introduce a function $inv(x)$ with the axiom
$\vdash_x x(1 - inv(x) x) = 0$ and we get a conservative extension. Note that $inv(x)$
is total and that $inv(0)$ also returns some value.

An example in algebraically closed fields is to introduce a function $sqrt(x)$ with the axiom
$sqrt(x)^2 = x$. Since we have $\vdash_{x} \exists u~(u^2 = x)$, we also get a conservative
extension. Note that $sqrt(x)$ has to choose between two complementary numbers.
The model described in \cite{Mannaa} has no square root function.

\subsection{Local rings}

Another example is the theory of local rings, given by the equational theory of rings
with the rules
$$
0=1\vdash\bot~~~~~~~~~~~~~~~~~~~~~~~~~~\vdash_x Inv(x)\vee Inv(1-x)
$$
where $Inv(x)$ means $\exists y~(xy = 1)$. 

The generic model is given by the site of finitely presented rings with covering
$R\rightarrow R[1/x_i]$ for $1 = \ideal{x_1,\dots,x_n}$ (we can have $n = 0$ if $1=0$ in $R$).

We can prove in this theory
$$
\vdash_x \exists y~z~(x y = 1~\vee ~(1-x) z = 1)
$$
and introduce in a conservative way two Skolem functions $J(x)$ and $K(x)$ with the rule
$$
\vdash_x xJ(x) = 1~\vee~(1-x)K(x) = 1
$$
There are no such functions in the generic model,
since these functions should be defined at all levels. 
At the initial level we have the ring $\ints$ (generated by the
constants 0 and 1), and $\ints$ is not a local ring. For example,
$J(3)$ and $K(3)$ cannot be defined. 
(All functions on the generic local rings are polynomials but we don't need to use this fact.)

Despite the fact that the conservativity can be proved in a simple way, 
in the last case, we have no Skolem function in the generic model, 
and therefore we cannot simply rely on a semantical argument.


\section{Acknowledgement}
The first author acknowledges the support of the Centre for Advanced Study (CAS) in Oslo, Norway, which funded and hosted the research project Homotopy Type Theory and Univalent Foundations during the 2018/19 academic year.

\begin{thebibliography}{9}

\bibitem{BaazLeitsch94} 
M.~Baaz and A.~Leitsch.
\newblock{On Skolemization and Proof Complexity}.
Fundamenta Informaticae 20(4): 353--379, 1994.
\url{https://doi.org/10.3233/FI-1994-2044}


\bibitem{Barr} 
M.~Barr.
\newblock{Toposes without points}.
Journal of Pure and Applied Algebra 5(3): 265--280, 1974.\\
\url{https://doi.org/10.1016/0022-4049(74)90037-1}

\bibitem{BBC18}
M.A.~Bezem, U.~Buchholtz and T.~Coquand.
\newblock{Syntactic Forcing Models for Coherent Logic}.
\newblock \emph{Indagationes Mathematicae}, 
\url{https://doi.org/10.1016/j.indag.2018.06.004}.

\bibitem{Mannaa}
Th. Coquand and B. Mannaa.
\newblock{A Sheaf Model of the Algebraic Closure.}
\newblock{Proceedings of EPTCS, 2014.}
\url{https://doi.org/10.4204/EPTCS.164.2}

%\bibitem{CLR} M.~Coste, H.~Lombardi, and M.F.~Roy.
%\newblock{Dynamical methods in algebra: effective Nullstellens\"atze.}
%\newblock\emph{Annals of Pure and Applied Logic}~\textbf{111}(3):203--256, 2001.

\bibitem{DW}
G. Dowek and B. Werner.
\newblock{A constructive proof of Skolem theorem for constructive logic.}
\newblock{Manuscript, 2004. \url{http://www.lsv.fr/~dowek/Publi/skolem.pdf}}

%\bibitem{Gallier} 
%J. Gallier, 
%\newblock\emph{Logic for Computer Science: Foundations of Automatic Theorem Proving},
%Wiley, 1986. Freely available online at: \url{www.cis.upenn.edu/~jean/gbooks/logic.html}


\bibitem{Kock1976}
A.~Kock.
\newblock Universal projective geometry via topos theory.
\newblock {\em J. Pure Appl. Algebra}, 9(1):1--24, 1976/77.


\bibitem{MLM94}
S.~Mac~Lane and I.~Moerdijk.
\newblock {\em Sheaves in geometry and logic}.
\newblock Universitext. Springer-Verlag, New York, 1994.

\bibitem{Maehara}
S. Maehara.
\newblock{The predicate calculus with $\epsilon$-symbol.}
Journal of the Mathematical Society of Japan, \textbf{7}(4):323--344, 1955.

\bibitem{Mints}
G. Mints.
\newblock{Axiomatisation of a Skolem function in intuitionistic logic.}
\newblock{In: In M.~Faller, S.~Kaufmann and M.~Pauly,  editors,
\emph{Formalizing the dynamics of information}, pages 105--114, 
volume 92 of CSLI Lecture Notes, pages 105--114, 2000.}

\bibitem{Negri03}
S. Negri.
\newblock{Contraction-free sequent calculi for geometric
theories with an application to Barr’s theorem.}
\newblock{Arch. Math. Logic 42(4): 389--401, 2003.}

\bibitem{Skolem}
Th.~Skolem,
\newblock\emph{Logisch-kombinatorische Untersuchungen \"{u}ber
die Erf\"{u}llbarkeit % manual break
und Beweisbarkeit mathematischen S\"{a}tze
nebst einem Theoreme \"{u}ber dichte Mengen},
{Skrifter} I \textbf{4}:1--36, Det Norske Videnskaps-Akademi, 1920.
\newblock Also in: Jens Erik Fenstad, editor,
\emph{Selected Works in Logic by Th. Skolem}, pp.~103--136,
Universitetsforlaget, Oslo, 1970.

\bibitem{Wraith}
G. C. Wraith
\newblock{Intuitionistic algebra: some recent developments in topos theory.}
\newblock{Proceedings of the International Congress of Mathematicians (Helsinki, 1978), pp. 331--337.}

\end{thebibliography}

\end{document}      
